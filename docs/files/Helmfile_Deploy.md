# OSS Helm File Deploy Jenkins File

## Introduction

This jenkinsfile is used to store the contents of the OSS Helm File Deploy job. This job will take in a large set of input parameters (described below) and use these parameters
to deploy a IDUN/EIAP helmfile package into a cluster. It requires a few prerequisites (these are described below). The job that is created from this jenkinsfile is very large
and it is used to automate the install and upgrade steps for the Idun/EIAP product. This includes using the deployment manager to create an initial workdir, create all the secrets needed
to run a full IDUN/EIAP deployment and collect all the logs generated as part of the deployment or upgrade.

## Overview

The document covers the jenkins file used to deploy the OSS Helmfile for initial install and Upgrade.

Currently, when the file is executed, it will

- Pulls down the helmfile version given. It uses this helmfile to get the Integration chart versions.

- Pulls down a template site values file (site-values/ci) and update with the given environment parameters

- Ensures the appropriate CSAR's are available for the deployment.

> If the parameter "DOWNLOAD_CSARS" is set to false, then it pulls down the individual integration chart and builds mini CSAR. These mini CSARs just include the integration chart, the charts that the integration chart needs will be pulled down from the global docker registry during the deployment phase.

> If the parameter "DOWNLOAD_CSARS" is set to true, then it pulls down the appropriate CSAR's for the Integration chart version, if a CSAR is not found the deployment will exit. It is worth noting that this is the officially released full csars and not mini csars

- Using the deployment manager, the job will create a workdir, load in the certificates needed as part of the install/upgrade, load in the kube config file in order to access the target cluster and start the install/upgrade based off the input parameters

- If the deployment fails it will gather the environment logs from the failed system and attach them to the Jenkins job as an archived file

- If the deployment is successful, the job will create an artifacts.archive file and output it at the end of the job. (More details on this below)

## Resources

- [Jenkins Jobs](https://fem5s11-eiffel052.eiffel.gic.ericsson.se:8443/jenkins/job/helmfile-deploy/)

## Prerequisite

To be able to use this Jenkins job the following needs to be fulfilled

- All Certificates for the deployment added to the eo-integration-ci [repo](https://gerrit-gamma.gic.ericsson.se/gitweb?p=OSS/com.ericsson.oss.orchestration.eo/eo-integration-ci.git) into the <TEAM_NAME>/ci/environment/<CLUSTER_NAME>/<NAMESPACE>/certificates directory.

- Kube Config File added to Jenkins within the Credentials Section.

**NOTE** Make sure the Kube config file has the correct API key so that it can be accessed as external to the Director.
The Kube config file should be stored in Jenkins credentials as a "Secret File" and the ID given to the file can be used within the Jenkins job for the parameter.

- ARM Registry Credentials (armdocker.rnd.ericsson.se) added to Jenkins within the Credentials Section. This is needed to pull the application images during the deployment

- **Optional**: Local Docker Credentials (registry.C15.ericsson.se) added to Jenkins within the Credentials Section. Needed to pull the application images during the deployment. This is only needed if executing using the real CSAR's.

### Repo Files

The following files within the oss-integration-ci [repo](https://gerrit-gamma.gic.ericsson.se/#/admin/projects/OSS/com.ericsson.oss.aeonic/oss-integration-ci)
are used in its execution.

- ci/jenkins/files/helmfileDeploy.Jenkinsfile *(Main Jenkins File)*
- ci/jenkins/rulesets/ruleset2.0.yaml
- ci/jenkins/scripts/python-ci-scripts/

The following files within the com.ericsson.idunaas.ci [repo](https://gerrit-gamma.gic.ericsson.se/#/admin/projects/ENMaaS/com.ericsson.idunaas.ci)
are used in its execution.

- com.ericsson.idunaas.ci/jenkins/scripts/ymerge.py
- com.ericsson.idunaas.ci/jenkins/scripts/ymerge.sh

### Resources

The following job is used within the Base and Product staging flows

- [Jenkins Jobs](https://fem5s11-eiffel052.eiffel.gic.ericsson.se:8443/jenkins/job/helmfile-deploy/)

The following job is used within the aaS staging flows

- [Idun aaS Jenkins Jobs](https://fem2s11-eiffel216.eiffel.gic.ericsson.se:8443/jenkins/job/idunaas_deploy_helmfile/)

### Parameters

#### Input Parameters

The following is a list of parameters that are used within the file.

| Parameter                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Defaults                                                                         |
|-----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
| PLATFORM_TYPE                           | This parameter is used to determine the platform that EIAP is installed in. Eg:- Azure, AWS, CCD, openshift, etc...                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | default                                                                          |
| FLOW_AREA                               | This parameter refers to the lifecycle stage of EIAP. Eg:- eiapaas, release, productstaging, appstaging, etc..                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | default                                                                          |
| INT_CHART_VERSION                       | The version of the file to install                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                  |
| INT_CHART_NAME                          | File Name, i.e. eric-eiae-helmfile                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                  |
| INT_CHART_REPO                          | Repo to pull file from                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | https://arm.seli.gic.ericsson.se/artifactory/proj-eo-drop-helm                   |
| OPTIONAL_KEY_VALUE_LIST                 | Optional comma separated list of additional key/value pairs to be added to site values. Each key level should be separated by '.' and value by '=', e.g. eric-cloud-native-base.eric-sec-access-mgmt.accountManager.enabled=true,eric-oss-common-base.eric-oss-ddc.autoUpload.enabled=false                                                                                                                                                                                                                                                                                                                                       | None                                                                             |
| DEPLOYMENT_TYPE                         | Deployment Type, set "install" or "upgrade"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | install                                                                          |
| DEPLOYMENT_MANAGER_DOCKER_IMAGE         | The full image url and tag for the deployment manager to use for the deployment testing. If the tag is set to default, the deployment manager info will be fetched from the dm_version.yaml file if it exists in the helmfile tar file under test.                                                                                                                                                                                                                                                                                                                                                                                | armdocker.rnd.ericsson.se/proj-eric-oss-drop/eric-oss-deployment-manager:default |
| ARMDOCKER_USER_SECRET                   | ARM Docker secret ID that was stored in the Jenkins credentials area                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                  |
| SPINNAKER_PIPELINE_ID                   | ID of the associated Spinnaker pipeline. Used as a placeholder in order to mitigate Jenkins 404 errors.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 123456                                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                  |
| HELM_TIMEOUT                            | Time in seconds for the Deployment Manager to wait for the deployment to execute                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 1800                                                                             |
| DOCKER_TIMEOUT                          | Time in seconds for the Deployment Manager to wait for the pulling of docker images to be used for deployment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 60                                                                               |
| TAGS                                    | List of tags for applications that have to be deployed (e.g: so adc pf). Enter "None" into this field to leave all tags as false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | so pf uds adc th dmm eas                                                         |
| LA_HOSTNAME                             | Hostname for Log Aggregator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | default                                                                          |
| IAM_HOSTNAME                            | Hostname for IAM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | default                                                                          |
| SO_HOSTNAME                             | Hostname for SO                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | default                                                                          |
| UDS_HOSTNAME                            | Hostname for UDS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | default                                                                          |
| PF_HOSTNAME                             | Hostname for PF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | default                                                                          |
| GAS_HOSTNAME                            | Hostname for GAS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | default                                                                          |
| ADC_HOSTNAME                            | Hostname for ADC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | default                                                                          |
| APPMGR_HOSTNAME                         | Hostname for APPMGR_HOSTNAME                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | default                                                                          |
| TA_HOSTNAME                             | Hostname for Task Automation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | default                                                                          |
| EAS_HOSTNAME                            | Hostname for Ericsson Adaptation Support Automation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | default                                                                          |
| CH_HOSTNAME                             | Hostname for Configuration Handling                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | default                                                                          |
| TH_HOSTNAME                             | Hostname for Topology Handling                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | default                                                                          |
| OS_HOSTNAME                             | Hostname for Oran Support                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | default                                                                          |
| VNFM_HOSTNAME                           | Hostname for EO EVNFM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | default                                                                          |
| VNFM_REGISTRY_HOSTNAME                  | Registry hostname for EO EVNFM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | default                                                                          |
| GLOBAL_VNFM_REGISTRY_HOSTNAME           | Global Registry hostname for EO EVNFM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | default                                                                          |
| GR_HOSTNAME                             | Hostname for EO GR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | default                                                                          |
| GR_SECONDARY_HOSTNAME                   | Secondary Hostname for EO GR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | default                                                                          |
| ML_HOSTNAME                             | Hostname for Machine Learning(ML) Application                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | default                                                                          |
| BDR_HOSTNAME                            | Hostname for Bulk Data Repository (BDR) Application                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | default                                                                          |
| AVIZ_HOSTNAME                           | Hostname for Assurance Visualization Application                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | default                                                                          |
| EO_CM_HOSTNAME                          | Hostname for EO CM Hostname                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | default                                                                          |
| HELM_REGISTRY_HOSTNAME                  | Hostname for EO HELM Registry                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | default                                                                          |
| EO_LM_HOSTNAME                          | Hostname for EO LM Hostname                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | default                                                                          |
| EO_LM_GIT_HOSTNAME                      | Hostname for EO LM GIT Hostname                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | default                                                                          |
| EO_LM_OCI_HOSTNAME                      | Hostname for EO LM OCI registry                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | default                                                                          |
| VNFLCM_SERVICE_DEPLOY                   | EO VM VNFM DEPLOY, EO VM VNFM Deploy, set "true" or "false"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 'false'                                                                          |
| HELM_SERVICE_DEPLOY                     | EO VM VNFM DEPLOY, EO VM VNFM Deploy, set "true" or "false"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 'false'                                                                          |
| IDUN_USER_SECRET                        | Jenkins secret ID for default Idun aaS user password                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | idun_credentials                                                                 |
| PATH_TO_AWS_FILES                       | Path within the Repo to the location of the Idun aaS AWS credentials and config                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | NONE                                                                             |
| AWS_ECR_TOKEN                           | AWS ECR token for aws public environments for Idun aaS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | NONE                                                                             |
| FULL_PATH_TO_SITE_VALUES_FILE           | Full path within the Repo to the site_values.yaml file                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                  |
| PATH_TO_SITE_VALUES_OVERRIDE_FILE       | Path within the Repo to the location of the site values override file(s). <br/><br/> The content will be added or will override the content in the FULL_PATH_TO_SITE_VALUES_FILE. Use CSV format for more than 1 override file (in order that the files are to be merged). <br/><br/> A detailed overview of the override functionality can be found [here](https://confluence-oss.seli.wh.rnd.internal.ericsson.com/display/DGBase/Overview+of+override+files)                                                                                                                                                                   | NONE                                                                             |
| PATH_TO_CERTIFICATES_FILES              | Path within the Repo to the location of the certificates directory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                  |
| NAMESPACE                               | Namespace to install the Chart                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                  |
| KUBECONFIG_FILE                         | Kubernetes configuration file to specify which environment to install on                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                  |
| FUNCTIONAL_USER_SECRET                  | Jenkins secret ID for ARM Registry Credentials                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ciloopman-user-creds                                                              |
| FUNCTIONAL_USER_TOKEN                   | Jenkins secret token ID for ARM Registry. To obtain this token for a particular user profile, log on as that user to Artifactory and click to edit the user profile on the top right corner. Enter user password to enable the features on the page. Next, click on the "Generate an Identity Token" button. Enter a description of the token and click Next. The token is then generated. Make sure to copy and store the generated token before exiting. More on Artifactory token management can be seen in: https://jfrog.com/help/r/jfrog-platform-administration-documentation/introduction-to-the-user-profile Credentials | NONE                                                                             |
| SLAVE_LABEL                             | Specify the slave label that you want the job to run on                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | evo_docker_engine                                                                |
| WHAT_CHANGED                            | Variable to store what chart contains the changes (Internal Use)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | None                                                                             |
| DOCKER_REGISTRY                         | Set this to the docker registry to execute the deployment from. Used when deploying from officially released CSARs <br /><br/> If the parameter "DOWNLOAD_CSARS" is set to true, this parameter should be set to clusters local registry, which needs to be a real FQDN with the entry in DNS.                                                                                                                                                                                                                                                                                                                                    | armdocker.rnd.ericsson.se                                                        |
| DOCKER_REGISTRY_CREDENTIALS             | Jenkins secret ID for the Docker Registry. Not needed if deploying from armdocker.rnd.ericsson.se, <br /><br/> If the paramater "DOWNLOAD_CSARS" is set to true, this needs to be set also.                                                                                                                                                                                                                                                                                                                                                                                                                                       | None                                                                             |
| DOWNLOAD_CSARS                          | When set to true the script will try to download the officially released CSARs relation to the version of the applications within the helmfile being deployed. <br/><br/>If set to true, ensure the DOCKER_REGISTRY & DOCKER_REGISTRY_CREDENTIALS parameters are set appropriately                                                                                                                                                                                                                                                                                                                                                | false                                                                            |
| CRD_NAMESPACE                           | Namespace which was used to deploy the CRD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | crd-namespace                                                                    |
| DEPLOY_ALL_CRDS                         | Used within CI when deploying multiple deployments in the one cluster. When set to true ensures all tagged CRDs are set to true, to ensure no dependency mismatch between deployments                                                                                                                                                                                                                                                                                                                                                                                                                                             | false                                                                            |
| IPV6_ENABLE                             | Used to enable IPV6 within the site values file when set to true                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | false                                                                            |
| INGRESS_IP                              | Ingress IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | default                                                                          |
| INGRESS_CLASS                           | ICCR ingress class name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | default                                                                          |
| VNFLCM_SERVICE_IP                       | LB IP for the VNF LCM service                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 0.0.0.0                                                                          |
| EO_CM_IP                                | EO CM IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | default                                                                          |
| EO_CM_ESA_IP                            | EO CM ESA IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | default                                                                          |
| FH_SNMP_ALARM_IP                        | LB IP for FH SNMP Alarm Provider, For EO and EIC used within value eric-cloud-native-base.eric-fh-snmp-alarm-provider.loadBalancerIP. For EOcCM used within global.externalIPv4.loadBalancerIP                                                                                                                                                                                                                                                                                                                                                                                                                                    | default                                                                          |
| USE_DM_PREPARE                          | When set to true uses the site values generated from the Deployment manager prepare command for the deployment. <br/> <br/>**Note:** The values within the prepared site values from the Deployment manager, will be overwritten by the values generated in the CI Site values for both initial install and upgrade.                                                                                                                                                                                                                                                                                                              | false                                                                            |
| USE_SKIP_IMAGE_PUSH                     | Set to true to use the Deployment Manager parameter "--skip-image-check-push" in case an image push is done in advance. If false will deploy without the "--skip-image-check-push" parameter.                                                                                                                                                                                                                                                                                                                                                                                                                                     | false                                                                            |
| USE_SKIP_UPGRADE_FOR_UNCHANGED_RELEASES | Set to true to use the Deployment Manager parameter "--skip-upgrade-for-unchanged-releases" to skip helm upgrades for helm releases whose versions and values have not changed. If false will deploy without the "--skip-upgrade-for-unchanged-releases" parameter'.                                                                                                                                                                                                                                                                                                                                                              | false                                                                            |
| USE_CERTM                               | Set to true to use the "--use-certm" tag during the deployment. <br/> <br/>**Note:** This parameter is specific for EIC only.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | false                                                                            |
| COLLECT_LOGS                            | If set to "true" (by default) - logs will be collected. If false - will not collect logs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | false                                                                            |
| COLLECT_LOGS_WITH_DM                    | If set to "false" (by default) - logs will be collected by ADP logs collection script. If true - with deployment-manager tool.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | false                                                                            |
| ENV_CONFIG_FILE                         | Points to a file which contains a set of KEY and VALUES. If a filename (other than default) is set then the generated site values file will be scanned and any KEY found in the file will be substituted with its VALUE. See [example](#ENV_CONFIG_FILE)                                                                                                                                                                                                                                                                                                                                                                          | default                                                                          |
| DDP_AUTO_UPLOAD                         | Set it to "true" when enabling the DDP auto upload and also need to add the DDP instance details into ENV_CONFIG_FILE and SITE_VALUES_OVERRIDE_FILE                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | false                                                                            |
| CI_DOCKER_IMAGE                         | CI Docker image to use. Mainly used in CI Testing flows. If the version for the image is set to default, the version in VERSION_PREFIX file from the repo is used to fetch the image. Other option available, latest or a specific version.                                                                                                                                                                                                                                                                                                                                                                                       | armdocker.rnd.ericsson.se/proj-eric-oss-drop/eric-oss-ci-scripts:default         |
| TIMEOUT                                 | Time to wait in seconds before the job should timeout                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 3600                                                                             |
| SUBMODULE_SYNC_TIMEOUT                  | Number of seconds before the submodule sync command times out                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 60                                                                               |
| SUBMODULE_UPDATE_TIMEOUT                | Number of seconds before the submodule update command times out                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 300                                                                              |
| GERRIT_REFSPEC                          | Can be used to fetch job JenkinsFile from branch (refs/heads/master) or commit (refs/changes/95/156395/1) / 95 - last 2 digits of Gerrit commit number / 156395 - is Gerrit commit number / 1 - patch number of gerrit commit / Only to be used during testing                                                                                                                                                                                                                                                                                                                                                                    | refs/heads/master                                                                |


>> **Note** See the following page for more details on credential's storage, [README](Credentials_Storage.md)

> NOTE
> Prerequisites for using the CSAR Download Functionality:

> - Jenkins Slave needs a connection to the local docker registry in the deployment.
> - Jenkins Slave should have sufficient root store to hold the CSAR's (Total CSAR size X 3.5)

> Why 3.5 times the CSAR size,
>
> - Download the CSAR's to the Root Disk
> - Extraction of the Images to the Root disk
> - Load the images into Docker for upload to the local docker registry.

#### Output File

An artifact.properties file is generated and attached to the Jenkins execution at the end of the flow assuming the deployment/upgrade was successful.

This artifact.properties file will contain 4 key value pairs. UNCHANGED_CHART_NAME, UNCHANGED_CHART_REPO, UNCHANGED_CHART_VERSION and DEPLOYMENT_MANAGER_VERSION.
These key pairs are usually used by other jenkins jobs at later stages of some spinnaker flows.

Example 1 :

```
UNCHANGED_CHART_NAME=None
UNCHANGED_CHART_REPO=None
UNCHANGED_CHART_VERSION=None
DEPLOYMENT_MANAGER_VERSION=1.37.0-45
```

Example 2 :

```
UNCHANGED_CHART_NAME=eric-tm-ingress-controller-cr-crd
UNCHANGED_CHART_REPO=https://arm.sero.gic.ericsson.se/artifactory/proj-adp-umbrella-released-helm/
UNCHANGED_CHART_VERSION=eric-tm-ingress-controller-cr-crd/eric-tm-ingress-controller-cr-crd
DEPLOYMENT_MANAGER_VERSION=1.37.0-45
```

Alternatively, if the deployment/upgrade fails then we will get a different set of output files. Usually there will be 4 files outputted in this case, but this can change
as these files are generated from the deployment managers collect-logs command:

- TimeStamp_init.log: This is the contents of the deployment manager init command logs
- TimeStamp_install.log or  TimeStamp_upgrade.log: This is the contents of the deployment manager install or upgrade command logs. It depends on if an install or an upgrade happened as part of the run
- TimeStamp_logs.log: This is the contents of the deployment manager collect-logs commands. it usually collects details from the kubernetes cluster, more specifically the state of the cluster post install/upgrade.
- logs_NameSpace_TimeStamp.tgz: This is a compressed file that contents logs from install/upgrade that the deployment manager collect-logs gathers. It usually contents logs
from the helm deployment, and the latest state of the kubernetes cluster.

## Jenkins Job Configuration

> **Note:** to create a new Jenkins job the user should have the correct access rights to the Jenkins server

If the job needs to be created on a Jenkins server, the following needs to be followed

- Create a new Pipeline Jenkins Job
- Within the "Pipeline Section" of the Jenkins Job Configuration set the following
  - **Definition:** Pipeline script from SCM
  - **SCM:** Git
  - **Repositories URL:** ${GERRIT_MIRROR}/OSS/com.ericsson.oss.aeonic/oss-integration-ci
  - **Credentials:** Choose appropriate credentials for Gerrit cloning
  - **Branches to build:** master
  - **Script Path:** ci/jenkins/files/helmfileDeploy.Jenkinsfile

> **Note:** Once the repo has been configured in the Jenkins job, there is no need to configure the parameters, the job on execution
will automatically create all the parameter(s) on the first execution. The job will fail though on first execution, but this is expected behaviour.

### Override file

The override file specified in this job is used to add optional values to the site values file used for the II/UG.
A detailed overview of the override functionality can be found [here](https://confluence-oss.seli.wh.rnd.internal.ericsson.com/display/DGBase/Overview+of+override+files).

### ENV_CONFIG_FILE

Set ENV_CONFIG_FILE to /dummy/path/to/config/file.conf<br>
Snip of the Contents of that file:

```
...
# Hostnames for the Deployment
EO_VNFM_HOSTNAME=evnfm.hart904.rnd.gic.ericsson.se
EO_SO_HOSTNAME=so.hart904.rnd.gic.ericsson.se
EO_SO_TEST_HOSTNAME_1=auth.server1.hart904.rnd.gic.ericsson.se
EO_SO_TEST_HOSTNAME_2=mtls.server1.hart904.rnd.gic.ericsson.se
EO_PF_HOSTNAME=pf.hart904.rnd.gic.ericsson.see
...
```

Snip of Contents of PATH_TO_SITE_VALUES_OVERRIDE_FILE:

```
eric-eo-so:
  eric-eo-auth-test:
    ingress:
      hostname: EO_SO_TEST_HOSTNAME_1
      tls:
        enabled: true
      mtls:
        hostname: EO_SO_TEST_HOSTNAME_2
        enabled: true
```

Output in the site values file for deployment:

```
eric-eo-so:
  eric-eo-auth-test:
    ingress:
      hostname: auth.server1.hart904.rnd.gic.ericsson.se
      tls:
        enabled: true
      mtls:
        hostname: mtls.server1.hart904.rnd.gic.ericsson.se
        enabled: true
```

### Testing

In order to test a Jenkins file (Without affecting the master branch), please refer to the [Contributing Guide](../Contribution_Guide.md).

## Contributing

We are an inner source project and welcome contributions. See our
[Contributing Guide](../Contribution_Guide.md) for details.

## Contacts

### Guardians

See in [Contributing Guide](../Contribution_Guide.md)

### Backlog

Create a new issue on Ticketmaster component under ADPPRG project:

Report [Support/Bug](https://jira-oss.seli.wh.rnd.internal.ericsson.com/browse/IDUN-4091)

See in [Contributing Guide](../Contribution_Guide.md) for further details

### Support

Support is available on our Teams channel:

- Send questions via
  [Ticketmaster - General](https://teams.microsoft.com/l/channel/19%3a9f5ed758e3a6405daffee42e0284268b%40thread.skype/General?groupId=1483901a-b5c4-445a-b707-aa7a5d0c1b4c&tenantId=92e84ceb-fbfd-47ab-be52-080c6b87953f)
  Microsoft Teams channel
